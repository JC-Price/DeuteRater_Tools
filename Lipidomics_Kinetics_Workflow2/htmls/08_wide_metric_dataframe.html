<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Merge Rates & Fraction-New — Wide Metabolic Table</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      padding: 24px;
      background: #f4f8fb;
      color: #222;
      line-height: 1.6;
    }
    h1 {
      color: #126782;
      font-size: 1.9rem;
      margin-bottom: 16px;
    }
    h2 {
      color: #1f618d;
      margin-top: 24px;
      margin-bottom: 8px;
    }
    .box {
      background: #ffffff;
      border-left: 6px solid #126782;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      padding: 18px 22px;
      margin: 18px 0;
      border-radius: 8px;
    }
    code {
      background: #eef3f7;
      padding: 2px 5px;
      border-radius: 4px;
      font-size: 0.95rem;
    }
    em { color: #444; }
    .hint {
      color: #666;
      font-size: 0.9rem;
      margin-top: 6px;
    }
    .hidden-run { display: none; }
  </style>
</head>
<body>

<h1>Merge Rates &amp; Fraction-New into a Wide Metabolic Table</h1>

<div class="box">
  <h2>Purpose of this step</h2>
  <p>
    This step consolidates your kinetic outputs into a single, analysis-ready dataframe. It merges the
    <code>fraction_new.tsv</code> and <code>rates_by_sequence.tsv</code> files generated by
    <strong>DeuteRater</strong> with identifiers and Concatenated ID file originating from <strong>IsobarHandler</strong> and
    <strong>MS-DIAL</strong>. The resulting <em>wide metabolic metric table</em> provides a unified view of
    kinetic and abundance parameters across all biological groups.
  </p>

  <p>
    Each lipid species is represented by its empirically measured kinetic parameters —
    <em>n<sub>L</sub></em> (incorporable deuterium count), <em>A<sub>syn</sub></em> (fraction of endogenous synthesis),
    and <em>k</em> (turnover rate constant) — along with DeuteRater-derived abundance metrics, 
     confidence intervals (CIs) and standard deviations.
  </p>
</div>

<div class="box">
  <h2>What the script does</h2>
  <p>
    The helper tool automates the merging, cleaning, and reshaping of DeuteRater (Fraction-New and Rates) outputs
    along with concatenated ID file into a comprehensive wide-format dataframe suitable for visualization and statistical modeling.
  </p>

  <p>When executed, it will:</p>
  <ul>
    <li>Prompt you to input your <strong>biological group names</strong> (case-sensitive DeuteRater sample groups).</li>
    <li>Prompt you to select:
      <ul>
        <li>Your <strong>Fraction-New</strong> table (<code>fraction_new.tsv</code> or Excel file),</li>
        <li>Your <strong>Rates</strong> table (<code>rates_by_sequence.tsv</code> or Excel file), and</li>
        <li>Your <strong>Concatenated ID file</strong> table.</li>
      </ul>
    </li>
    <li>Normalize and coerce numeric columns, including handling list-like abundance values, and compute
        <strong>per-file DeuteRater abundances</strong> (labeled with <code>Abundance_..._DR</code> columns).</li>
    <li>Reshape the merged data into a wide-format matrix:
      <ul>
        <li>Pivot metrics per biological group.</li>
        <li>Keep key identifiers (Alignment ID, Lipid Unique Identifier, Formula).</li>
        <li>Merge Fraction-New, Rates, and Concatenated ID file tables robustly, handling duplicate columns.</li>
      </ul>
    </li>
    <li>Compute <strong>per-group summary statistics</strong>:
      <ul>
        <li>Median abundances</li>
        <li>Standard deviations and relative standard deviations (RSD)</li>
        <li>Bootstrap 95% confidence intervals</li>
        <li>Adjust p-values on abundances using Benjamini–Hochberg FDR correction</li>
      </ul>
    </li>
    <li>Export the consolidated and fully annotated dataframe as <code>merged_results.csv</code>.</li>
  </ul>

  <p class="hint">
    This master table forms the foundation for all subsequent analyses — including volcano plots,
    conformity plots (rate vs. abundance homeostasis), per-experiment statistical summaries,
    and ontology-level analyses.
  </p>
</div>


<div class="box">
  <h2>Entering Biological Group Names</h2>
  <p>
    When prompted, enter a <strong>comma-delimited list</strong> of your biological group names exactly as they
    appear in your datafile names (for example each of the <em>Nielsen et&nbsp;al.,&nbsp;2026</em> datafiles is annotated with either A2, A3 or A4). This is case-sensitive and must match the sample group identifiers
    in the dataframe.
  </p>
  <p>For example: <code>A2,A3,A4</code></p>
  <p>
    This step is important because the script uses these names to:
  </p>
  <ul>
    <li>Correctly pivot metrics per biological group.</li>
    <li>Compute per-group summary statistics (median, standard deviation, RSD, confidence intervals).</li>
    <li>Ensure that all downstream analyses — such as plots and tables — are grouped correctly.</li>
  </ul>
  <p class="hint">
    Mistyping a group name may cause missing or misaligned data in the merged results.
  </p>
</div>


<div class="box">
  <h2>Outputs</h2>
  <ul>
    <li><strong>merged_results.csv</strong> — wide-format metabolic metric table integrating rates, fraction-new,
        abundances, and statistical measures per condition.</li>
    <li>Group-specific columns for kinetic parameters (<em>k</em>, <em>A<sub>syn</sub></em>, <em>n<sub>L</sub></em>),
        abundance medians, confidence intervals, and <em>p</em>-values.</li>
    <li>Ready input for downstream visualization and comparative modeling (e.g., genotype- or treatment-based analysis).</li>
  </ul>
</div>

<!-- Hidden anchor ensures GUI detects and displays the “run” button -->
<a href="run:Generating_wide_dataframe\Generating_wide_dataframe.cmd" data-label="Create Wide Dataframe">
  <div class="hidden-run">Merge Rates & Fraction-New</div>
</a>


<p class="hint">If Generating_wide_dataframe\Generating_wide_dataframe.cmd (or ish) exists in the working directory, the “Create Wide Dataframe” button will appear below and execute it.</p>

</body>
</html>
